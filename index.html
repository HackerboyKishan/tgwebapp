<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Copy callback ID</title>
  <style>
    body { font-family: Arial, sans-serif; margin:20px; display:flex;flex-direction:column;gap:12px;align-items:center; }
    pre { background:#f4f4f4;padding:10px;border-radius:6px;max-width:100%;overflow:auto; }
    button { padding:10px 16px; font-size:16px; border-radius:8px; cursor:pointer; }
  </style>
</head>
<body>
  <h2>Your callback id</h2>
  <pre id="idbox">Loading...</pre>
  <button id="copyBtn">Copy to clipboard</button>

  <script>
    // read id from query param
    function getQueryParam(name) {
      const url = new URL(window.location.href);
      return url.searchParams.get(name);
    }

    const idbox = document.getElementById('idbox');
    const copyBtn = document.getElementById('copyBtn');

    // 1) Try to use query param `id`
    let cbId = getQueryParam('id');

    // 2) If not present, try Telegram WebApp initDataUnsafe (if opened inside Telegram)
    if ((!cbId || cbId === 'null') && window.Telegram && Telegram.WebApp && Telegram.WebApp.initDataUnsafe) {
      // initDataUnsafe may contain user/chat; callback id may not be present; this is fallback only
      const unsafe = Telegram.WebApp.initDataUnsafe;
      cbId = unsafe?.query_id || unsafe?.inline_query_id || unsafe?.callback_query_id || null;
    }

    if (!cbId) {
      idbox.textContent = 'No callback id found. Open the Web App from the bot after pressing the button.';
      copyBtn.disabled = true;
    } else {
      idbox.textContent = cbId;
      copyBtn.addEventListener('click', async () => {
        try {
          await navigator.clipboard.writeText(cbId);
          alert('Copied to clipboard!');
        } catch (e) {
          alert('Copy failed. Please copy manually: ' + cbId);
        }
      });
    }
  </script>
</body>
</html>
